!function(a,b){function c(a,c,b){a[c]=a[c]||b}var d=["responseType","withCredentials","timeout","onprogress"];a.ajax=function(a,g){function e(a,c){return function(){t||(g(void 0===h.status?a:h.status,0===h.status?"Error":h.response||h.responseText||c,h),t=!0)}}var f=a.headers||{},k=a.body,m=a.method||(k?"POST":"GET"),t=!1,h=a.I&&b.XDomainRequest&&!/MSIE 1/.test(navigator.userAgent)?new XDomainRequest:b.XMLHttpRequest?new XMLHttpRequest:void 0;h.open(m,a.url,!0);var z=h.onload=e(200);h.onreadystatechange=
function(){4===h.readyState&&z()};h.onerror=e(null,"Error");h.ontimeout=e(null,"Timeout");h.onabort=e(null,"Abort");k&&(c(f,"X-Requested-With","XMLHttpRequest"),b.FormData&&k instanceof b.FormData||c(f,"Content-Type","application/x-www-form-urlencoded"));m=0;for(var A=d.length;A>m;m++){var n=d[m];void 0!==a[n]&&(h[n]=a[n])}for(n in f)h.setRequestHeader(n,f[n]);return h.send(k),h};b.nanoajax=a}({},function(){return this}());function p(a){if(!a.target)throw Error("You must specify a target element into which the cloud will be generated");if(!a.data)throw Error("You must data for cloud generation, data can be a valid JSON String, a javascript object or a URL String");try{var b=a.target instanceof HTMLElement}catch(c){throw Error("Browser is unsupported");}if(!b)throw Error("target option should specify a valid DOM Element");if(""!==a.target.innerHTML)throw Error("target should be empty");a.generationSpeed&&(this.generationSpeed=
parseInt(a.generationSpeed,10));a.sizeCount&&(this.sizeCount=parseInt(a.sizeCount,10));a.textSize&&(this.textSize=parseFloat(a.textSize));a.rotationStep&&(this.rotationStep=parseFloat(a.rotationStep));this.a=this.h=null;this.b=a.target;this.i=!0===a.ignoreBadItems;this.g=[];this.j=[];this.o=this.l=this.s=0;"object"===typeof a.data?(this.a=a.data,q(this)):0===a.data.indexOf("{")?(this.h=a.data,this.a=JSON.parse(this.h),q(this)):r(a.data,this.C.bind(this))}
p.prototype={D:{label:"string",sentimentScore:"number",sentiment:"object",volume:"number",id:"string"},m:{en:{stats_title:'Information on topic "{string}":',total_mentions:"Total Mentions: {string}",positive_mentions:'Positive Mentions: <span class="mention_positive">{string}</span>',neutral_mentions:'Neutral Mentions: <span class="mention_neutral">{string}</span>',negative_mentions:'Negative Mentions: <span class="mention_negative">{string}</span>'}},sizeCount:6,language:"en",generationSpeed:10,
textSize:12,rotationStep:20,C:function(a){this.h=a;this.a=JSON.parse(this.h);try{q(this)}catch(b){console.error(b.message)}},F:function(){this.f={x:window.innerWidth/2,y:window.innerHeight/2};0<this.b.clientWidth&&0<this.b.clientHeight&&(this.f={x:this.b.clientWidth/2,y:this.b.clientHeight/2});u(this)},A:function(a){this.sizeCount=parseInt(a,10);this.j=v(this);for(var b in this.a.topics)w(this,this.a.topics[b]);u(this)},v:function(a){this.generationSpeed=parseInt(a,10);u(this)},w:function(a){this.rotationStep=
parseInt(a,10);u(this)},B:function(a){this.textSize=parseInt(a,10);this.b.style.fontSize=this.textSize+"px";u(this)},setSizeCount:function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.s);this.s=setTimeout(this.A.bind(this,a),250)},setGenerationSpeed:function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.l);this.l=setTimeout(this.v.bind(this,a),250)},setRotationStep:function(a){if("number"!==typeof a)throw Error("value must be a number");
clearTimeout(this.G);this.G=setTimeout(this.w.bind(this,a),250)},setTextSize:function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.u);this.u=setTimeout(this.B.bind(this,a),250)}};function x(a){a.sort(function(a,c){return a-c});var b=999999,c=0,d;for(d in a){var f=a[d+1]-d;f<b&&(c=d,b=f)}a.splice(c,2,(a[c]+a[parseInt(c,10)+1])/2);return a}
function y(a,b,c){if(!a.m[a.language][b])throw Error("Translation for String ID: "+b+" not found, check translations file for language: "+a.H);a=a.m[a.language][b];return void 0!==c&&-1<a.indexOf("{string}")?a.replace("{string}",c):a}function B(a,b,c,d,f){for(var g=0;g<a.g.length;g++){var e=a.g[g];if(!(e.x>b+d||e.x+e.width<b||e.y>c+f||e.y+e.height<c))return!0}return!1}
function w(a,b,c){null==c&&(c=b.c.querySelector(".cloudWord"));a=a.j;var d=999999,f=0,g;for(g in a){var e=Math.abs(b.volume-a[g]);e<d&&(d=e,f=g)}b.size=parseInt(f,10)+1;c.style.fontSize=b.size+"em"}
function u(a){a.g=[];a.a.topics.sort(function(a,b){return b.volume-a.volume});for(var b=0;b<a.a.topics.length;b++)a.b.appendChild(a.a.topics[b].c),setTimeout(function(a){a.width=a.c.clientWidth;a.height=a.c.clientHeight;var b=this.f.x-a.width/2,c=this.f.y-a.height/2;a.c.querySelector(".cloudWord").style.width=a.width+"px";a.c.querySelector(".cloudWord").style.height=a.height+"px";for(var g=0;B(this,b,c,a.width,a.height);){g+=this.generationSpeed;for(var e=0;360>e;){var l=Math.PI/180*(e+0),k=Math.cos(l)*
g;l=Math.sin(l)*g;if(!B(this,b+k,c+l,a.width,a.height)){b+=k;c+=l;break}e+=this.rotationStep}}a.c.style.top=c+"px";a.c.style.left=b+"px";this.g.push({x:b,y:c,width:a.width,height:a.height})}.bind(a,a.a.topics[b]),100)}
function C(a){for(var b=0;b<a.a.topics.length;b++){var c=a.a.topics[b],d=a,f=a.a.topics[b],g=document.createElement("div");g.className="cloudWordContainer";var e=document.createElement("span");e.innerText=f.label;e.className="cloudWord";var l=d,k=f,m=e;k.display=60<k.sentimentScore?"positive":40>k.sentimentScore?"negative":"neutral";m.className+=" "+k.display;w(l,k,m);l=document.createElement("div");l.className="metadata";l.innerHTML="<h4>"+y(d,"stats_title",f.label)+"</h4><p>"+y(d,"total_mentions",
f.volume)+"</p><p>"+y(d,"positive_mentions",f.sentiment.positive||0)+"<br>"+y(d,"neutral_mentions",f.sentiment.neutral||0)+"<br>"+y(d,"negative_mentions",f.sentiment.negative||0)+"<br></p>";g.appendChild(e);g.appendChild(l);c.c=g}u(a)}function v(a){for(var b=[],c=0;c<a.a.topics.length;c++)-1===b.indexOf(a.a.topics[c].volume)&&b.push(a.a.topics[c].volume);for(b.sort(function(a,b){return a-b});b.length>a.sizeCount;)b=x(b);return b}
function D(a,b,c){for(var d in c){if(!b.hasOwnProperty(d))return!1;if("object"===typeof c[d])return D(a,b[d],c[d]);if(typeof b[d]!==c[d])return!1}return!0}
function E(a){if(!a.a.topics)throw Error("Schema Error, expected root array named topics");for(var b=[],c=0;c<a.a.topics.length;c++)if(D(a,a.a.topics[c],a.D))a.i&&b.push(a.a.topics[c]);else if(a.i)console.warn("Item: "+c+" does not conform to schema, Ignoring",a.a.topics[c]);else throw Error("Schema Error, item: "+c+" does not conform to schema");a.i&&(a.a.topics=b)}
function q(a){a.f={x:window.innerWidth/2,y:window.innerHeight/2};0<a.b.clientWidth&&0<a.b.clientHeight&&(a.f={x:a.b.clientWidth/2,y:a.b.clientHeight/2});E(a);a.b.style.fontSize=a.textSize+"px";a.b.className+=" CloudiaCloud";a.j=v(a);C(a);window.addEventListener("resize",function(){clearTimeout(this.o);this.o=setTimeout(this.F.bind(this),250)}.bind(a))}function r(a,b){nanoajax.ajax({url:a},function(a,d){200<=a&&300>a&&b(d)})}window.Cloudia=p;
