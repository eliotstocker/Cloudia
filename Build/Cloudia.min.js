!function(a,b){function c(a,c,b){a[c]=a[c]||b}var e=["responseType","withCredentials","timeout","onprogress"];a.ajax=function(a,d){function f(a,c){return function(){u||(d(void 0===g.status?a:g.status,0===g.status?"Error":g.response||g.responseText||c,g),u=!0)}}var k=a.headers||{},l=a.body,m=a.method||(l?"POST":"GET"),u=!1,g=a.G&&b.XDomainRequest&&!/MSIE 1/.test(navigator.userAgent)?new XDomainRequest:b.XMLHttpRequest?new XMLHttpRequest:void 0;g.open(m,a.url,!0);var z=g.onload=f(200);g.onreadystatechange=
function(){4===g.readyState&&z()};g.onerror=f(null,"Error");g.ontimeout=f(null,"Timeout");g.onabort=f(null,"Abort");l&&(c(k,"X-Requested-With","XMLHttpRequest"),b.FormData&&l instanceof b.FormData||c(k,"Content-Type","application/x-www-form-urlencoded"));m=0;for(var A=e.length;A>m;m++){var p=e[m];void 0!==a[p]&&(g[p]=a[p])}for(p in k)g.setRequestHeader(p,k[p]);return g.send(l),g};b.nanoajax=a}({},function(){return this}());function n(a){if(!a.target)throw Error("You must specify a target element into which the cloud will be generated");if(!a.data)throw Error("You must data for cloud generation, data can be a valid JSON String, a javascript object or a URL String");try{var b=a.target instanceof HTMLElement}catch(c){throw Error("Browser is unsupported");}if(!b)throw Error("target option should specify a valid DOM Element");if(""!==a.target.innerHTML)throw Error("target should be empty");a.generationSpeed&&(this.generationSpeed=
parseInt(a.generationSpeed,10));a.sizeCount&&(this.sizeCount=parseInt(a.sizeCount,10));a.textSize&&(this.textSize=parseFloat(a.textSize));this.a=this.h=null;this.b=a.target;this.i=!0===a.ignoreBadItems;this.g=[];this.j=[];this.o=this.l=this.s=0;"object"===typeof a.data?(this.a=a.data,q(this)):0===a.data.indexOf("{")?(this.h=a.data,this.a=JSON.parse(this.h),q(this)):r(a.data,this.A.bind(this))}
n.prototype={B:{label:"string",sentimentScore:"number",sentiment:"object",volume:"number",id:"string"},m:{en:{stats_title:'Information on topic "{string}":',total_mentions:"Total Mentions: {string}",positive_mentions:'Positive Mentions: <span class="mention_positive">{string}</span>',neutral_mentions:'Neutral Mentions: <span class="mention_neutral">{string}</span>',negative_mentions:'Negative Mentions: <span class="mention_negative">{string}</span>'}},sizeCount:6,language:"en",generationSpeed:10,
textSize:12,A:function(a){this.h=a;this.a=JSON.parse(this.h);try{q(this)}catch(b){console.error(b.message)}},C:function(){this.f={x:window.innerWidth/2,y:window.innerHeight/2};0<this.b.clientWidth&&0<this.b.clientHeight&&(this.f={x:this.b.clientWidth/2,y:this.b.clientHeight/2});t(this)},v:function(a){this.sizeCount=parseInt(a,10);this.j=v(this);for(var b in this.a.topics)w(this,this.a.topics[b],10);t(this)},u:function(a){this.generationSpeed=parseInt(a,10);t(this)},w:function(a){this.textSize=parseInt(a,
10);this.b.style.fontSize=this.textSize+"px";t(this)},setSizeCount:function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.s);this.s=setTimeout(this.v.bind(this,a),250)},setGenerationSpeed:function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.l);this.l=setTimeout(this.u.bind(this,a),250)},setTextSize:function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.D);this.D=setTimeout(this.w.bind(this,
a),250)}};function x(a){a.sort(function(a,c){return a-c});var b=999999,c=0,e;for(e in a){var f=a[e+1]-e;f<b&&(c=e,b=f)}a.splice(c,2,(a[c]+a[parseInt(c,10)+1])/2);return a}function y(a,b,c){if(!a.m[a.language][b])throw Error("Translation for String ID: "+b+" not found, check translations file for language: "+a.F);a=a.m[a.language][b];return void 0!==c&&-1<a.indexOf("{string}")?a.replace("{string}",c):a}
function B(a,b,c,e,f){for(var d=0;d<a.g.length;d++){var h=a.g[d];if(!(h.x>b+e||h.x+h.width<b||h.y>c+f||h.y+h.height<c))return!0}return!1}function w(a,b,c){null==c&&(c=b.c.querySelector(".cloudWord"));a=a.j;var e=999999,f=0,d;for(d in a){var h=Math.abs(b.volume-a[d]);h<e&&(e=h,f=d)}b.size=parseInt(f,10)+1;c.style.fontSize=b.size+"em"}
function t(a){a.g=[];a.a.topics.sort(function(a,b){return b.volume-a.volume});for(var b=0;b<a.a.topics.length;b++)a.b.appendChild(a.a.topics[b].c),setTimeout(function(a){a.width=a.c.clientWidth;a.height=a.c.clientHeight;var b=this.f.x-a.width/2,c=this.f.y-a.height/2;a.c.querySelector(".cloudWord").style.width=a.width+"px";a.c.querySelector(".cloudWord").style.height=a.height+"px";for(var d=0;B(this,b,c,a.width,a.height);)(d+=this.generationSpeed,B(this,b,c+d,a.width,a.height))?B(this,b+d,c+d,a.width,
a.height)?B(this,b+d,c,a.width,a.height)?B(this,b+d,c-d,a.width,a.height)?B(this,b,c-d,a.width,a.height)?B(this,b-d,c-d,a.width,a.height)?B(this,b-d,c,a.width,a.height)?B(this,b-d,c+d,a.width,a.height)||(b-=d,c+=d):b-=d:(b-=d,c-=d):c-=d:(b+=d,c-=d):b+=d:(c+=d,b+=d):c+=d;a.c.style.top=c+"px";a.c.style.left=b+"px";this.g.push({x:b,y:c,width:a.width,height:a.height})}.bind(a,a.a.topics[b]),100)}
function C(a){for(var b=0;b<a.a.topics.length;b++){var c=a.a.topics[b],e=a,f=a.a.topics[b],d=document.createElement("div");d.className="cloudWordContainer";var h=document.createElement("span");h.innerText=f.label;h.className="cloudWord";var k=e,l=f,m=h;l.display=60<l.sentimentScore?"positive":40>l.sentimentScore?"negative":"neutral";m.className+=" "+l.display;w(k,l,m);k=document.createElement("div");k.className="metadata";k.innerHTML="<h4>"+y(e,"stats_title",f.label)+"</h4><p>"+y(e,"total_mentions",
f.volume)+"</p><p>"+y(e,"positive_mentions",f.sentiment.positive||0)+"<br>"+y(e,"neutral_mentions",f.sentiment.neutral||0)+"<br>"+y(e,"negative_mentions",f.sentiment.negative||0)+"<br></p>";d.appendChild(h);d.appendChild(k);c.c=d}t(a)}function v(a){for(var b=[],c=0;c<a.a.topics.length;c++)-1===b.indexOf(a.a.topics[c].volume)&&b.push(a.a.topics[c].volume);for(b.sort(function(a,b){return a-b});b.length>a.sizeCount;)b=x(b);return b}
function D(a,b,c){for(var e in c){if(!b.hasOwnProperty(e))return!1;if("object"===typeof c[e])return D(a,b[e],c[e]);if(typeof b[e]!==c[e])return!1}return!0}
function E(a){if(!a.a.topics)throw Error("Schema Error, expected root array named topics");for(var b=[],c=0;c<a.a.topics.length;c++)if(D(a,a.a.topics[c],a.B))a.i&&b.push(a.a.topics[c]);else if(a.i)console.warn("Item: "+c+" does not conform to schema, Ignoring",a.a.topics[c]);else throw Error("Schema Error, item: "+c+" does not conform to schema");a.i&&(a.a.topics=b)}
function q(a){a.f={x:window.innerWidth/2,y:window.innerHeight/2};0<a.b.clientWidth&&0<a.b.clientHeight&&(a.f={x:a.b.clientWidth/2,y:a.b.clientHeight/2});E(a);a.b.style.fontSize=a.textSize+"px";a.b.className+=" CloudiaCloud";a.j=v(a);C(a);window.addEventListener("resize",function(){clearTimeout(this.o);this.o=setTimeout(this.C.bind(this),250)}.bind(a))}function r(a,b){nanoajax.ajax({url:a},function(a,e){200<=a&&300>a&&b(e)})}window.Cloudia=n;
