!function(a,b){function c(a,c,b){a[c]=a[c]||b}var d=["responseType","withCredentials","timeout","onprogress"];a.ajax=function(a,h){function e(a,c){return function(){u||(h(void 0===g.status?a:g.status,0===g.status?"Error":g.response||g.responseText||c,g),u=!0)}}var k=a.headers||{},l=a.body,p=a.method||(l?"POST":"GET"),u=!1,g=a.H&&b.XDomainRequest&&!/MSIE 1/.test(navigator.userAgent)?new XDomainRequest:b.XMLHttpRequest?new XMLHttpRequest:void 0;g.open(p,a.url,!0);var z=g.onload=e(200);g.onreadystatechange=
function(){4===g.readyState&&z()};g.onerror=e(null,"Error");g.ontimeout=e(null,"Timeout");g.onabort=e(null,"Abort");l&&(c(k,"X-Requested-With","XMLHttpRequest"),b.FormData&&l instanceof b.FormData||c(k,"Content-Type","application/x-www-form-urlencoded"));p=0;for(var A=d.length;A>p;p++){var m=d[p];void 0!==a[m]&&(g[m]=a[m])}for(m in k)g.setRequestHeader(m,k[m]);return g.send(l),g};b.nanoajax=a}({},function(){return this}());function f(a){if(!a.target)throw Error("You must specify a target element into which the cloud will be generated");if(!a.data)throw Error("You must data for cloud generation, data can be a valid JSON String, a javascript object or a URL String");try{var b=a.target instanceof HTMLElement}catch(c){throw Error("Browser is unsupported");}if(!b)throw Error("target option should specify a valid DOM Element");if(""!==a.target.innerHTML)throw Error("target should be empty");a.generationSpeed&&(this.generationSpeed=
parseInt(a.generationSpeed,10));a.sizeCount&&(this.sizeCount=parseInt(a.sizeCount,10));a.textSize&&(this.textSize=parseFloat(a.textSize));a.rotationStep&&(this.rotationStep=parseFloat(a.rotationStep));this.b=this.h=null;this.a=a.target;this.i=!0===a.ignoreBadItems;this.g=[];this.j=[];this.o=this.l=this.s=0;"object"===typeof a.data?(this.b=a.data,n(this)):0===a.data.indexOf("{")?(this.h=a.data,this.b=JSON.parse(this.h),n(this)):q(a.data,this.C.bind(this))}
function q(a,b){nanoajax.ajax({url:a},function(a,d){200<=a&&300>a&&b(d)})}f.prototype.C=function(a){this.h=a;this.b=JSON.parse(this.h);try{n(this)}catch(b){console.error(b.message)}};
function n(a){a.f={x:window.innerWidth/2,y:window.innerHeight/2};0<a.a.clientWidth&&0<a.a.clientHeight&&(a.f={x:a.a.clientWidth/2,y:a.a.clientHeight/2});t(a);a.a.style.fontSize=a.textSize+"px";a.a.className+=" CloudiaCloud";a.j=v(a);w(a);window.addEventListener("resize",function(){clearTimeout(a.o);a.o=setTimeout(a.F,250)})}
function t(a){if(!a.b.topics)throw Error("Schema Error, expected root array named topics");var b=[];a.b.topics.map(function(c,d){if(x(a,c,a.D))a.i&&b.push(c);else if(a.i)console.warn("Item: "+d+" does not conform to schema, Ignoring",c);else throw Error("Schema Error, item: "+d+" does not conform to schema");return c});a.i&&(a.b.topics=b)}function x(a,b,c){for(var d in c){if(!b.hasOwnProperty(d))return!1;if("object"===typeof c[d])return x(a,b[d],c[d]);if(typeof b[d]!==c[d])return!1}return!0}
function v(a){var b=[];a.b.topics.map(function(a){-1===b.indexOf(a.volume)&&b.push(a.volume);return a});for(b.sort(function(a,b){return a-b});b.length>a.sizeCount;)b=y(b);return b}
function w(a){a.b.topics.map(function(b){var c=document.createElement("div");c.className="cloudWordContainer";var d=document.createElement("span");d.innerText=b.label;d.className="cloudWord";b.display=60<b.sentimentScore?"positive":40>b.sentimentScore?"negative":"neutral";d.className+=" "+b.display;B(a,b,d);var e=document.createElement("div");e.className="metadata";e.innerHTML="<h4>"+C(a,"stats_title",b.label)+"</h4><p>"+C(a,"total_mentions",b.volume)+"</p><p>"+C(a,"positive_mentions",b.sentiment.positive||
0)+"<br>"+C(a,"neutral_mentions",b.sentiment.neutral||0)+"<br>"+C(a,"negative_mentions",b.sentiment.negative||0)+"<br></p>";c.appendChild(d);c.appendChild(e);b.c=c;return b});D(a)}
function D(a){a.g=[];a.b.topics.sort(function(a,c){return c.volume-a.volume});a.b.topics.map(function(b){a.a.appendChild(b.c);setTimeout(function(b){b.width=b.c.clientWidth;b.height=b.c.clientHeight;var c=a.f.x-b.width/2,e=a.f.y-b.height/2;b.c.querySelector(".cloudWord").style.width=b.width+"px";b.c.querySelector(".cloudWord").style.height=b.height+"px";for(var h=0;E(a,c,e,b.width,b.height);){h+=a.generationSpeed;for(var r=0;360>r;){var k=Math.PI/180*r,l=Math.cos(k)*h;k=Math.sin(k)*h;if(!E(a,c+l,
e+k,b.width,b.height)){c+=l;e+=k;break}r+=a.rotationStep}}b.c.style.top=e+"px";b.c.style.left=c+"px";a.g.push({x:c,y:e,width:b.width,height:b.height})}.bind(void 0,b),100);return b})}function B(a,b,c){null==c&&(c=b.c.querySelector(".cloudWord"));b.size=F(b.volume,a.j)+1;c.style.fontSize=b.size+"em"}function E(a,b,c,d,e){if(!a.g.length)return!1;var h=!1;a.g.forEach(function(a){a.x>b+d||a.x+a.width<b||a.y>c+e||a.y+a.height<c||(h=!0)});return h}
f.prototype.F=function(){this.f={x:window.innerWidth/2,y:window.innerHeight/2};0<this.a.clientWidth&&0<this.a.clientHeight&&(this.f={x:this.a.clientWidth/2,y:this.a.clientHeight/2});D(this)};function C(a,b,c){if(!a.m[a.language][b])throw Error("Translation for String ID: "+b+" not found, check translations file for language: "+a.language);a=a.m[a.language][b];return void 0!==c&&-1<a.indexOf("{string}")?a.replace("{string}",c):a}
function F(a,b){var c=999999,d=0;b.map(function(b,h){var e=Math.abs(a-b);e<c&&(c=e,d=h);return b});return parseInt(d,10)}function y(a){a.sort(function(a,b){return a-b});var b=999999,c=0;a.map(function(d,e){var h=a[e+1]-d;h<b&&(c=e,b=h);return d});a.splice(c,2,(a[c]+a[parseInt(c,10)+1])/2);return a}f.prototype.A=function(a){var b=this;this.sizeCount=parseInt(a,10);this.j=v(this);this.b.topics.map(function(a){B(b,a);return a});D(this)};f.prototype.v=function(a){this.generationSpeed=parseInt(a,10);D(this)};
f.prototype.w=function(a){this.rotationStep=parseInt(a,10);D(this)};f.prototype.B=function(a){this.textSize=parseInt(a,10);this.a.style.fontSize=this.textSize+"px";D(this)};f.prototype.setSizeCount=function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.s);this.s=setTimeout(this.A.bind(this,a),250)};f.prototype.setGenerationSpeed=function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.l);this.l=setTimeout(this.v.bind(this,a),250)};
f.prototype.setRotationStep=function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.G);this.G=setTimeout(this.w.bind(this,a),250)};f.prototype.setTextSize=function(a){if("number"!==typeof a)throw Error("value must be a number");clearTimeout(this.u);this.u=setTimeout(this.B.bind(this,a),250)};f.prototype.D={label:"string",sentimentScore:"number",sentiment:"object",volume:"number",id:"string"};
f.prototype.m={en:{stats_title:'Information on topic "{string}":',total_mentions:"Total Mentions: {string}",positive_mentions:'Positive Mentions: <span class="mention_positive">{string}</span>',neutral_mentions:'Neutral Mentions: <span class="mention_neutral">{string}</span>',negative_mentions:'Negative Mentions: <span class="mention_negative">{string}</span>'}};f.prototype.sizeCount=6;f.prototype.language="en";f.prototype.generationSpeed=10;f.prototype.textSize=12;f.prototype.rotationStep=20;
window.Cloudia=f;
